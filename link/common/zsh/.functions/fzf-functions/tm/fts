# adapted from https://github.com/ThePrimeagen/.dotfiles/blob/master/bin/.local/scripts/tmux-sessionizer

if [ $# -eq 1 ]; then
  selected=$1
else
  selected=$(find ~/Personal/Code ~/Workspace/Code -maxdepth 1 -mindepth 1 -type d | fzf)
fi

if [ -z $selected ]; then
  return
fi

selected_name=$(basename "$selected" | tr . _)
tmux_running=$(pgrep tmux)

if [ -z $TMUX ]; then
  # tmux not running or tmux is in detached mode
  if [ -z $tmux_running ]; then
    # tmux not running, create a detached session
    tmux new-session -ds $selected_name -c $selected
  else
    # tmux is in detached mode 
    if ! tmux has-session -t=$selected_name 2> /dev/null; then
      # tmux doesn't have given session name
      tmux new-session -ds $selected_name -c $selected
    fi
  fi

  tmux attach -t $selected_name
else
  # tmux running and attached
  if ! tmux has-session -t=$selected_name 2> /dev/null; then
    tmux new-session -ds $selected_name -c $selected
  fi

  tmux switch-client -t $selected_name
fi

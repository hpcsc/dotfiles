local do_export=true

if [[ "$1" == "-n" ]]; then
  do_export=false
  shift
fi

if [[ $# -eq 0 ]]; then
  echo "Usage: read-secrets [-n] VAR1 VAR2 ..." >&2
  return 1
fi

for var in "$@"; do
  printf '%s: ' "$var" >&2
  IFS= read -rs "$var"
  echo >&2
  if $do_export; then
    export "$var"
  fi
done

if $do_export; then
  echo "Variables exported as environment variables. Verify with: typeset -p VAR_NAME (look for -x flag)" >&2
else
  echo "Variables set as shell variables only. Verify with: typeset -p VAR_NAME (no -x flag)" >&2
fi
